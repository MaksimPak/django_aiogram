{% extends 'admin/change_form.html' %}
{% load helpers %}


{% block submit_buttons_bottom %}
    {{ block.super }}
<!--        <div class="submit-row">-->
<!--                <input type="submit" value="Start course" name="_start_course">-->
<!--        </div>-->
{% endblock %}


{% block footer %}
    {{ block.super }}
    <div id="content">
    <table>
        <thead>
            <tr>
                <th>Lesson Name</th>
                <th>Students Received Vid</th>
                <th>Count Students Received</th>
                <th>Students Viewed Vid</th>
                <th>Count students viewed</th>
                <th>Students submitted hw</th>
                <th>Count students submitted hw</th>
                <th>send lessons</th>
            </tr>
        </thead>
        <tbody>
            {% for lesson in lessons %}
                <tr>
                    <td>{{lesson.title}}</td>
                    <td>
                        <form action="{% url 'dashboard:send_message' %}" method="post" class="receivedVid">
                            {% csrf_token %}
                            {% for student in lesson|students_received %}
                                {% if student not in lesson|students_watched %}
                                    <input type="hidden" name="_student_received" value="{{student.id}}">
                                    <a href="{% url 'admin:dashboard_client_change' student.id %}">
                                        {{student.first_name|slice:":1"}}.{{student.last_name}}
                                    </a>
                                {% endif %}
                            {% endfor %}
                            {%  if lesson|students_received %}
                            <button type="submit" style="font-size:10px;">Отправить сообщение</button>
                            {% endif %}
                        </form>
                    </td>
                    <td>{{lesson|students_received|length}}</td>
                    <td>
                        <form action="{% url 'dashboard:send_message' %}" method="post" class="viewedVid">
                            {% csrf_token %}
                            {% for student in lesson|students_watched %}
                                {% if student not in lesson|students_hw_submitted %}
                                <input type="hidden" name="_student_received" value="{{student.id}}">
                                <a href="{% url 'admin:dashboard_client_change' student.id %}">
                                    {{student.first_name|slice:":1"}}.{{student.last_name}}
                                </a>
                                {% endif %}
                            {% endfor %}
                            {% if lesson|students_watched %}
                                <button type="submit" style="font-size:10px;">Отправить сообщение</button>
                            {% endif %}
                        </form>
                    </td>

                    <td>{{lesson|students_watched|length}}</td>
                    <td>
                        <form action="{% url 'dashboard:send_message' %}" method="post" class="hwSubmitted">
                            {% csrf_token %}
                            {% for student in lesson|students_hw_submitted %}
                                <input type="hidden" name="_student_received" value="{{student.id}}">
                                <a href="{% url 'admin:dashboard_student_change' student.id %}">
                                    {{student.first_name|slice:":1"}}.{{student.last_name}}
                                </a>
                            {% endfor %}
                            {% if lesson|students_hw_submitted %}
                                <button type="submit" style="font-size:10px;">Отправить сообщение</button>
                            {% endif %}
                        </form>
                    </td>
                    <td>
                        {{ lesson|students_hw_submitted|length}}
                    </td>
                    <td><a href="{% url 'dashboard:send_lesson' object_id lesson.id %}">Выслать</a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
{% endblock %}